åœ¨ **Kubernetes (K8s)** ä¸­ï¼Œå·ï¼ˆ**Volume**ï¼‰é€šå¸¸æ˜¯æŒ‡ **Persistent Volume (PV)** å’Œ **Persistent Volume Claim (PVC)**ï¼Œå®ƒä»¬çš„çŠ¶æ€åˆ†åˆ«è¡¨ç¤ºå­˜å‚¨èµ„æºå’Œå­˜å‚¨è¯·æ±‚çš„å½“å‰ä½¿ç”¨æƒ…å†µã€‚

------

## ğŸ“¦ **1. Persistent Volume (PV) çš„çŠ¶æ€**

`PersistentVolume (PV)` æ˜¯ç”±ç®¡ç†å‘˜æˆ–åŠ¨æ€ä¾›åº”çš„æŒä¹…åŒ–å­˜å‚¨èµ„æºï¼Œä»¥ä¸‹æ˜¯å®ƒçš„å‡ ç§å¸¸è§çŠ¶æ€ï¼š

| **çŠ¶æ€**      | **è¯´æ˜**                                   |
| ------------- | ------------------------------------------ |
| **Available** | PV **æœªè¢«ä½¿ç”¨**ï¼Œå¯ä¾› PVC ç»‘å®šã€‚           |
| **Bound**     | PV **å·²ç»‘å®š**åˆ° PVCï¼Œæ­£åœ¨è¢«ä½¿ç”¨ã€‚          |
| **Released**  | PVC å·²åˆ é™¤ï¼Œ**æ•°æ®æœªæ¸…ç†**ï¼Œç­‰å¾…å›æ”¶å¤„ç†ã€‚ |
| **Failed**    | PV **å›æ”¶å¤±è´¥**ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†ã€‚            |

------

### ğŸ“Œ **1.1 æŸ¥çœ‹ PV çŠ¶æ€**

```bash
kubectl get pv
```

ç¤ºä¾‹è¾“å‡ºï¼š

```bash
NAME         CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM              STORAGECLASS   AGE
pv-local     10Gi       RWO            Retain           Bound       default/my-pvc     local-storage  12h
pv-unused    20Gi       RWO            Delete           Available   -                 standard       5m
```

### ğŸ“Œ **1.2 PV çŠ¶æ€è¯´æ˜**

1. **Available**ï¼š

   - PV **ç©ºé—²**ï¼Œæœªè¢« PVC ç»‘å®šï¼Œå¯ä¾›ä½¿ç”¨ã€‚
   - è§£å†³æ–¹æ³•ï¼šç¡®ä¿ PVC å®šä¹‰ä¸ PV çš„**å®¹é‡**ã€**è®¿é—®æ¨¡å¼**å’Œ**StorageClass**åŒ¹é…ã€‚

2. **Bound**ï¼š

   - PV **å·²è¢« PVC ç»‘å®š**ï¼Œæ­£åœ¨è¢« Pod ä½¿ç”¨ï¼Œ**æ­£å¸¸çŠ¶æ€**ã€‚
   - è§£å†³æ–¹æ³•ï¼šæ— éœ€å¤„ç†ï¼Œè¡¨ç¤º PV å·²ç»æˆåŠŸåˆ†é…ç»™ PVCã€‚

3. **Released**ï¼š

   - PVC åˆ é™¤åï¼ŒPV è¿›å…¥**é‡Šæ”¾**çŠ¶æ€ï¼Œä½†æ•°æ®ä»åœ¨ç£ç›˜ä¸­æœªæ¸…é™¤ã€‚

   - è§£å†³æ–¹æ³•ï¼š

     - å¦‚æœæƒ³

       é‡æ–°ä½¿ç”¨

       ï¼Œéœ€æ‰‹åŠ¨æ¸…ç†æ•°æ®ï¼Œè§£é™¤ PVC ç»‘å®šï¼š

       ```bash
       kubectl patch pv <pv-name> -p '{"spec":{"claimRef": null}}'
       ```

     - æˆ–ç›´æ¥

       åˆ é™¤ PV

       ï¼š

       ```bash
       kubectl delete pv <pv-name>
       ```

4. **Failed**ï¼š

   - PV **è‡ªåŠ¨å›æ”¶å¤±è´¥**ï¼Œé€šå¸¸ç”±äºå­˜å‚¨æ’ä»¶æˆ–é…ç½®é”™è¯¯ã€‚

   - è§£å†³æ–¹æ³•ï¼š

     - æŸ¥çœ‹ PV äº‹ä»¶å’Œé”™è¯¯ä¿¡æ¯ï¼š

       ```bash
       kubectl describe pv <pv-name>
       ```

     - ä¿®å¤é—®é¢˜æˆ–æ‰‹åŠ¨æ¸…ç†å’Œåˆ é™¤ PVã€‚

------

## ğŸ“‹ **2. Persistent Volume Claim (PVC) çš„çŠ¶æ€**

`PersistentVolumeClaim (PVC)` æ˜¯ç”¨æˆ·å¯¹æŒä¹…åŒ–å­˜å‚¨çš„è¯·æ±‚ï¼Œä»¥ä¸‹æ˜¯å®ƒçš„å‡ ç§å¸¸è§çŠ¶æ€ï¼š

| **çŠ¶æ€**    | **è¯´æ˜**                                     |
| ----------- | -------------------------------------------- |
| **Pending** | PVC **æœªç»‘å®š**ï¼Œæ­£åœ¨ç­‰å¾…åŒ¹é…çš„ PVã€‚          |
| **Bound**   | PVC **å·²ç»‘å®š**åˆ° PVï¼Œæ­£åœ¨ä½¿ç”¨ä¸­ã€‚            |
| **Lost**    | ç»‘å®šçš„ PV **ä¸¢å¤±**æˆ–è¢«åˆ é™¤ï¼Œæ— æ³•ä½¿ç”¨è¯¥ PVCã€‚ |

------

### ğŸ“Œ **2.1 æŸ¥çœ‹ PVC çŠ¶æ€**

```bash
kubectl get pvc
```

ç¤ºä¾‹è¾“å‡ºï¼š

```bash
NAME         STATUS    VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS   AGE
my-pvc       Bound     pv-local  10Gi       RWO            local-storage  12h
pvc-pending  Pending   -         5Gi        RWO            standard       2m
```

### ğŸ“Œ **2.2 PVC çŠ¶æ€è¯´æ˜**

1. **Pending**ï¼š

   - PVC ç”³è¯·å­˜å‚¨ï¼Œ**ä½†æ²¡æœ‰åˆé€‚çš„ PV** æ»¡è¶³è¦æ±‚ã€‚

   - è§£å†³æ–¹æ³•ï¼š

     1. æ£€æŸ¥

        æ˜¯å¦æœ‰æ»¡è¶³ PVC éœ€æ±‚çš„ PVï¼š

        ```bash
        kubectl get pv
        ```

     2. **ç¡®ä¿åŒ¹é…**çš„ StorageClassã€å®¹é‡ã€è®¿é—®æ¨¡å¼ç¬¦åˆ PVC éœ€æ±‚ã€‚

     3. å¦‚æœä½¿ç”¨åŠ¨æ€å­˜å‚¨ï¼Œæ£€æŸ¥ StorageClass æ˜¯å¦å­˜åœ¨ï¼š

        ```bash
        kubectl get storageclass
        ```

2. **Bound**ï¼š

   - PVC **æˆåŠŸç»‘å®š**åˆ° PVï¼Œ**æ­£å¸¸çŠ¶æ€**ï¼ŒPod å¯ä»¥ä½¿ç”¨è¯¥å·ã€‚
   - è§£å†³æ–¹æ³•ï¼šæ— éœ€å¤„ç†ï¼ŒPVC æ­£å¸¸å·¥ä½œã€‚

3. **Lost**ï¼š

   - PVC åŸæœ¬ç»‘å®šçš„ PV **è¢«åˆ é™¤**æˆ–**æ— æ³•ä½¿ç”¨**ï¼Œå¯¼è‡´ PVC ä¸¢å¤±ã€‚

   - è§£å†³æ–¹æ³•ï¼š

     1. æ£€æŸ¥

         PVC ç»‘å®šçš„ PV æ˜¯å¦å­˜åœ¨ï¼š

        ```bash
        kubectl get pv
        ```

     2. å¦‚æœ PV ä¸¢å¤±ï¼Œéœ€æ‰‹åŠ¨æ¸…ç†å¹¶é‡æ–°ç”³è¯· PVCï¼š

        ```bash
        kubectl delete pvc <pvc-name>
        ```

------

## ğŸ” **3. æ’æŸ¥ PV/PVC çŠ¶æ€å¼‚å¸¸**

### âœ… **3.1 æŸ¥çœ‹ PV å’Œ PVC è¯¦æƒ…**

1. æŸ¥çœ‹ 

   PV

    è¯¦æƒ…ï¼š

   ```bash
   kubectl describe pv <pv-name>
   ```

2. æŸ¥çœ‹ 

   PVC

    è¯¦æƒ…ï¼š

   ```bash
   kubectl describe pvc <pvc-name>
   ```

### âœ… **3.2 æŸ¥çœ‹ K8s äº‹ä»¶**

æ£€æŸ¥æœ€è¿‘çš„ PV/PVC ç›¸å…³äº‹ä»¶ï¼š

```bash
kubectl get events --sort-by='{.lastTimestamp}'
```

### âœ… **3.3 æ‰‹åŠ¨æ¸…ç†å¼‚å¸¸ PV/PVC**

1. åˆ é™¤ 

   å¼‚å¸¸ PVC

   ï¼š

   ```bash
   kubectl delete pvc <pvc-name>
   ```

2. æ¸…ç† 

   Released çŠ¶æ€

   çš„ PVï¼š

   ```bash
   kubectl patch pv <pv-name> -p '{"spec":{"claimRef": null}}'
   ```

3. åˆ é™¤ 

   Failed çŠ¶æ€

   çš„ PVï¼š

   ```bash
   kubectl delete pv <pv-name>
   ```

------

## ğŸ“Š **4. PV å’Œ PVC çŠ¶æ€ç”Ÿå‘½å‘¨æœŸ**

1. **åˆ›å»º PV** â†’ **Available**ï¼ˆå¯ç”¨çŠ¶æ€ï¼‰ã€‚

2. **ç”³è¯· PVC** â†’ **Pending**ï¼ˆç­‰å¾…åŒ¹é…ï¼‰ã€‚

3. **PVC åŒ¹é…æˆåŠŸ** â†’ **Bound**ï¼ˆå·²ç»‘å®šï¼‰ã€‚

4. åˆ é™¤ PVC

   ï¼š

   - å¦‚æœ `reclaimPolicy: Retain` â†’ **Released**ï¼ˆéœ€æ‰‹åŠ¨æ¸…ç†æ•°æ®ï¼‰ã€‚
   - å¦‚æœ `reclaimPolicy: Delete` â†’ **PV è‡ªåŠ¨åˆ é™¤**ã€‚

5. **å¼‚å¸¸æƒ…å†µ** â†’ **Failed**ã€**Lost**ã€‚

------

## ğŸ“˜ **5. æ€»ç»“**

- **PV çŠ¶æ€**ï¼š`Available`ã€`Bound`ã€`Released`ã€`Failed`ã€‚

- **PVC çŠ¶æ€**ï¼š`Pending`ã€`Bound`ã€`Lost`ã€‚

- å¸¸ç”¨å‘½ä»¤

  ï¼š

  - æŸ¥çœ‹ PV/PVC çŠ¶æ€ï¼š`kubectl get pv` / `kubectl get pvc`
  - æŸ¥çœ‹è¯¦æƒ…ï¼š`kubectl describe pv` / `kubectl describe pvc`
  - æ¸…ç†å¼‚å¸¸èµ„æºï¼š`kubectl delete pv` / `kubectl delete pvc`

- æ•…éšœæ’æŸ¥

  ï¼š

  - æ£€æŸ¥ PV å’Œ PVC ç»‘å®šå…³ç³»æ˜¯å¦ä¸€è‡´ã€‚
  - åŠ¨æ€å­˜å‚¨éœ€ç¡®ä¿ `StorageClass` æ­£å¸¸å·¥ä½œã€‚

