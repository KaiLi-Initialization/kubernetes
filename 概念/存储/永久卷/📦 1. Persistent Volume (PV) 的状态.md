在 **Kubernetes (K8s)** 中，卷（**Volume**）通常是指 **Persistent Volume (PV)** 和 **Persistent Volume Claim (PVC)**，它们的状态分别表示存储资源和存储请求的当前使用情况。

------

## 📦 **1. Persistent Volume (PV) 的状态**

`PersistentVolume (PV)` 是由管理员或动态供应的持久化存储资源，以下是它的几种常见状态：

| **状态**      | **说明**                                   |
| ------------- | ------------------------------------------ |
| **Available** | PV **未被使用**，可供 PVC 绑定。           |
| **Bound**     | PV **已绑定**到 PVC，正在被使用。          |
| **Released**  | PVC 已删除，**数据未清理**，等待回收处理。 |
| **Failed**    | PV **回收失败**，需要手动处理。            |

------

### 📌 **1.1 查看 PV 状态**

```bash
kubectl get pv
```

示例输出：

```bash
NAME         CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM              STORAGECLASS   AGE
pv-local     10Gi       RWO            Retain           Bound       default/my-pvc     local-storage  12h
pv-unused    20Gi       RWO            Delete           Available   -                 standard       5m
```

### 📌 **1.2 PV 状态说明**

1. **Available**：

   - PV **空闲**，未被 PVC 绑定，可供使用。
   - 解决方法：确保 PVC 定义与 PV 的**容量**、**访问模式**和**StorageClass**匹配。

2. **Bound**：

   - PV **已被 PVC 绑定**，正在被 Pod 使用，**正常状态**。
   - 解决方法：无需处理，表示 PV 已经成功分配给 PVC。

3. **Released**：

   - PVC 删除后，PV 进入**释放**状态，但数据仍在磁盘中未清除。

   - 解决方法：

     - 如果想

       重新使用

       ，需手动清理数据，解除 PVC 绑定：

       ```bash
       kubectl patch pv <pv-name> -p '{"spec":{"claimRef": null}}'
       ```

     - 或直接

       删除 PV

       ：

       ```bash
       kubectl delete pv <pv-name>
       ```

4. **Failed**：

   - PV **自动回收失败**，通常由于存储插件或配置错误。

   - 解决方法：

     - 查看 PV 事件和错误信息：

       ```bash
       kubectl describe pv <pv-name>
       ```

     - 修复问题或手动清理和删除 PV。

------

## 📋 **2. Persistent Volume Claim (PVC) 的状态**

`PersistentVolumeClaim (PVC)` 是用户对持久化存储的请求，以下是它的几种常见状态：

| **状态**    | **说明**                                     |
| ----------- | -------------------------------------------- |
| **Pending** | PVC **未绑定**，正在等待匹配的 PV。          |
| **Bound**   | PVC **已绑定**到 PV，正在使用中。            |
| **Lost**    | 绑定的 PV **丢失**或被删除，无法使用该 PVC。 |

------

### 📌 **2.1 查看 PVC 状态**

```bash
kubectl get pvc
```

示例输出：

```bash
NAME         STATUS    VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS   AGE
my-pvc       Bound     pv-local  10Gi       RWO            local-storage  12h
pvc-pending  Pending   -         5Gi        RWO            standard       2m
```

### 📌 **2.2 PVC 状态说明**

1. **Pending**：

   - PVC 申请存储，**但没有合适的 PV** 满足要求。

   - 解决方法：

     1. 检查

        是否有满足 PVC 需求的 PV：

        ```bash
        kubectl get pv
        ```

     2. **确保匹配**的 StorageClass、容量、访问模式符合 PVC 需求。

     3. 如果使用动态存储，检查 StorageClass 是否存在：

        ```bash
        kubectl get storageclass
        ```

2. **Bound**：

   - PVC **成功绑定**到 PV，**正常状态**，Pod 可以使用该卷。
   - 解决方法：无需处理，PVC 正常工作。

3. **Lost**：

   - PVC 原本绑定的 PV **被删除**或**无法使用**，导致 PVC 丢失。

   - 解决方法：

     1. 检查

         PVC 绑定的 PV 是否存在：

        ```bash
        kubectl get pv
        ```

     2. 如果 PV 丢失，需手动清理并重新申请 PVC：

        ```bash
        kubectl delete pvc <pvc-name>
        ```

------

## 🔍 **3. 排查 PV/PVC 状态异常**

### ✅ **3.1 查看 PV 和 PVC 详情**

1. 查看 

   PV

    详情：

   ```bash
   kubectl describe pv <pv-name>
   ```

2. 查看 

   PVC

    详情：

   ```bash
   kubectl describe pvc <pvc-name>
   ```

### ✅ **3.2 查看 K8s 事件**

检查最近的 PV/PVC 相关事件：

```bash
kubectl get events --sort-by='{.lastTimestamp}'
```

### ✅ **3.3 手动清理异常 PV/PVC**

1. 删除 

   异常 PVC

   ：

   ```bash
   kubectl delete pvc <pvc-name>
   ```

2. 清理 

   Released 状态

   的 PV：

   ```bash
   kubectl patch pv <pv-name> -p '{"spec":{"claimRef": null}}'
   ```

3. 删除 

   Failed 状态

   的 PV：

   ```bash
   kubectl delete pv <pv-name>
   ```

------

## 📊 **4. PV 和 PVC 状态生命周期**

1. **创建 PV** → **Available**（可用状态）。

2. **申请 PVC** → **Pending**（等待匹配）。

3. **PVC 匹配成功** → **Bound**（已绑定）。

4. 删除 PVC

   ：

   - 如果 `reclaimPolicy: Retain` → **Released**（需手动清理数据）。
   - 如果 `reclaimPolicy: Delete` → **PV 自动删除**。

5. **异常情况** → **Failed**、**Lost**。

------

## 📘 **5. 总结**

- **PV 状态**：`Available`、`Bound`、`Released`、`Failed`。

- **PVC 状态**：`Pending`、`Bound`、`Lost`。

- 常用命令

  ：

  - 查看 PV/PVC 状态：`kubectl get pv` / `kubectl get pvc`
  - 查看详情：`kubectl describe pv` / `kubectl describe pvc`
  - 清理异常资源：`kubectl delete pv` / `kubectl delete pvc`

- 故障排查

  ：

  - 检查 PV 和 PVC 绑定关系是否一致。
  - 动态存储需确保 `StorageClass` 正常工作。

